<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>MCM Stocks — Cash</title>
  <link href="https://fonts.googleapis.com/css?family=Source+Sans+Pro:300,400,600,700" rel="stylesheet" />
  <link rel="stylesheet" href="./main.css" />
  <script src="./main.js"></script>
  <style>
    .grid-2 { display:grid; grid-template-columns: 1fr 1fr; gap:16px; }
    @media (max-width: 900px){ .grid-2 { grid-template-columns: 1fr; } }
    .label { font-weight:600; margin:8px 0 4px; }
  </style>
</head>
<body>
  <header>
    <div style="font-weight:700">MCM Stocks</div>
    <nav>
      <ul>
        <li><a href="index.html" data-top="index.html">Home</a></li>
        <li><a href="trade.html" data-top="trade.html">Trade</a></li>
        <li><a href="cash.html" data-top="cash.html">Cash</a></li>

        <!-- Auth-aware nav items -->
        <li id="nav-login"><a href="login.html" data-top="login.html">Login</a></li>
        <li id="nav-register"><a href="register.html" data-top="register.html">Register</a></li>
        <li id="nav-logout" style="display:none;"><a href="#" onclick="logoutUser()">Logout</a></li>
      </ul>
    </nav>
  </header>

  <main class="dashboard">
    <aside class="sidebar">
      <div class="group">
        <div class="group-title">Main</div>
        <ul>
          <li><a href="dashboard.html" data-route="index.html">Overview</a></li>
          <li><a href="portfolio.html" data-route="portfolio.html">Portfolio</a></li>
          <li><a href="trade.html" data-route="trade.html">Trading</a></li>
          <li><a href="cash.html" data-route="cash.html">Cash</a></li>
        </ul>
      </div>
      <div class="group">
        <div class="group-title">Activity</div>
        <ul>
          <!-- filename corrected: tradehistory.html -->
          <li><a href="tradehistory.html" data-route="tradehistory.html">Trade History</a></li>
          <li><a href="profile.html" data-route="profile.html">Profile</a></li>
          <li><a href="settings.html" data-route="settings.html">Settings</a></li>
        </ul>
      </div>
      <div class="group">
        <div class="group-title">Quick</div>
        <ul>
          <li><a href="trade.html?sell=1" data-route="trade.html">Sell Stock</a></li>
          <li><a href="portfolio.html" data-route="portfolio.html">View Portfolio</a></li>
          <li><a href="research.html" data-route="research.html">Market Research</a></li>
        </ul>
      </div>
    </aside>

    <!-- content column -->
    <section class="content">
      <div class="card">
        <h1 style="margin-top:0;">Cash Management</h1>
        <div class="grid-2" style="margin-top:12px;">
          <div class="card" style="margin:0;">
            <h3 style="margin-top:0;">Deposit</h3>
            <label class="label">Amount (USD)</label>
            <input type="number" id="dep_amt" step="0.01" placeholder="100.00" />
            <label class="label">From</label>
            <select id="dep_src">
              <option>Bank Account (**** 1234)</option>
              <option>Debit Card (**** 5678)</option>
            </select>
            <button class="button positive" style="margin-top:12px;" id="btnDep">Deposit</button>
          </div>

          <div class="card" style="margin:0;">
            <h3 style="margin-top:0;">Withdraw</h3>
            <label class="label">Amount (USD)</label>
            <input type="number" id="wd_amt" step="0.01" placeholder="50.00" />
            <label class="label">To</label>
            <select id="wd_dst">
              <option>Bank Account (**** 1234)</option>
            </select>
            <button class="button positive" style="margin-top:12px;" id="btnWd">Withdraw</button>
          </div>
        </div>

        <p class="muted" id="cash-msg" style="margin-top:10px;"></p>
      </div>
    </section>
  </main>

  <footer class="content"><p class="muted">© 2025 MCM Stocks</p></footer>

  <script>
    // Require auth
    (function guard(){
      const { token } = (window.AuthAPI && AuthAPI.loadAuth()) || { token:'' };
      if (!token) location.replace('login.html');
    })();

    // Highlight active links
    (function highlight(){
      const p = location.pathname.split('/').pop() || 'cash.html';
      document.querySelectorAll('.sidebar a[data-route]').forEach(a =>
        a.classList.toggle('active', a.getAttribute('data-route') === p)
      );
      document.querySelectorAll('header nav a[data-top]').forEach(a =>
        a.classList.toggle('active', a.getAttribute('data-top') === p)
      );
    })();

    // Demo deposit/withdraw handlers (replace with real API when ready)
    const msg = (t)=>{ const el=document.getElementById('cash-msg'); el.textContent=t; };

    document.getElementById('btnDep').addEventListener('click', async ()=>{
      const amount = Number(document.getElementById('dep_amt').value||0);
      const src    = document.getElementById('dep_src').value;
      if (amount<=0) return msg('Enter a valid deposit amount.');
      // Example secured call (once you wire endpoints):
      // const res = await AuthAPI.fetch('/api/cash/deposit', { method:'POST', body: JSON.stringify({ amount, src }) });
      msg(`Deposit submitted (demo): $${amount.toFixed(2)} from ${src}`);
    });

    document.getElementById('btnWd').addEventListener('click', async ()=>{
      const amount = Number(document.getElementById('wd_amt').value||0);
      const dst    = document.getElementById('wd_dst').value;
      if (amount<=0) return msg('Enter a valid withdrawal amount.');
      // Example secured call:
      // const res = await AuthAPI.fetch('/api/cash/withdraw', { method:'POST', body: JSON.stringify({ amount, dst }) });
      msg(`Withdrawal submitted (demo): $${amount.toFixed(2)} to ${dst}`);
    });
  </script>

  <!-- Auth-aware nav toggle -->
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      const loggedIn = !!(window.AuthAPI && AuthAPI.isAuthenticated && AuthAPI.isAuthenticated());
      const logoutItem = document.getElementById("nav-logout");
      const loginItem  = document.getElementById("nav-login");
      const regItem    = document.getElementById("nav-register");

      if (loggedIn) {
        if (logoutItem) logoutItem.style.display = "inline-block";
        if (loginItem)  loginItem.style.display  = "none";
        if (regItem)    regItem.style.display    = "none";
      } else {
        if (logoutItem) logoutItem.style.display = "none";
        if (loginItem)  loginItem.style.display  = "inline-block";
        if (regItem)    regItem.style.display    = "inline-block";
      }
    });
  </script>
</body>
</html>
